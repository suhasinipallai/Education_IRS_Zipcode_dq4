---
title: "Untitled"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}
irs_2011_2015 <- readRDS('./r-objects/irs_2011_2015.rds')
ggplot_num_returns <- function(df, range, y.label="", point=FALSE) {
  df_sort_1 <- irs_2011_2015 %>% 
    dplyr::filter(sum_total_income_returns >= range) %>% 
    dplyr::select(
      county, year, sum_total_income_returns
    )
  
  p <- df_sort_1 %>% 
    ggplot(
      aes(
        x = year,
        y = sum_total_income_returns, 
        group = county,
        color = county
      )
    ) + 
    geom_line(size = 1.5) + 
    labs(y = y.label, x = "") +
    theme(axis.text.x = element_text(
        face = 'bold', 
        size = 14
      )
    ) +
    theme(axis.text.y = element_text(
        face = 'bold', 
        size = 14
      )
    ) +
    theme(axis.title.y = element_text(
        size = 20
      )
    ) +
    scale_y_continuous(labels = scales::comma) +
    scale_color_hue(l = 60, c = 50)
  
  if (point) {
    p + 
      geom_point() +
      geom_label(
        aes(label=sum_total_income_returns), 
        hjust = 0, 
        vjust = 0,
        nudge_x = -.5,
        nudge_y = .2
      )
  } else {
    p
  }
}
p1 <- ggplot_num_returns(irs_2011_2015, 20000, y.label = "Num of Tax Payers Per Year")

ggplotly(p1)

```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
core_region_act <- education_df_plus_3 %>% 
   group_by(CORE_region) %>% 
   summarize(
     avg_act =mean(ACT_Composite),
     avg_graduation = mean(Graduation),
     avg_expelled = mean(Pct_Expelled),
     avg_dropout = mean(Dropout),
     avg_hispanic= mean(Pct_Hispanic),
     avg_black = mean(Pct_Black),
     avg_native_american = mean(Pct_Native_American)
     ) %>% 
   ungroup() %>% 
   select(CORE_region,avg_act,avg_graduation,avg_expelled,avg_dropout,avg_hispanic,avg_black,avg_native_american) %>% 
  arrange(desc(avg_act)) 

 
melt_core <- melt(data=core_region_act,id.vars ="CORE_region")

p1 <- ggplot(data=melt_core,aes(x=CORE_region,y=value,color=variable)) +
  geom_point() +
  geom_smooth(method='lm')
ggplotly(p1)

p_plotly <- plot_ly(
  data = melt_core,
  x = ~ CORE_region,
  y = ~ value,
  type = "bar",
  name = "value",
  color = "red5",
  alpha = 0.75
) %>%
  add_bars(
    y = ~ value,
    name = "Approached",
    color = "orange3"
  ) %>%
  add_bars(
    y = ~ value,
    name = "Enrolled",
    color = "green4"
  )

p_plotly %>%
  layout(legend = list(x = 0, y = 0.95, bgcolor='transparent')
         )


```

### Chart C

```{r}

```

